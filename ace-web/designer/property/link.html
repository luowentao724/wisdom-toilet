
<form id="LinkForm">
    <input type="hidden" name="ele.id"/>
    <input type="hidden" name="ele.signalName"/>
    <table class="property-table" style="width:100%;height:auto;"
         cellpadding="0" cellspacing="0" border="1">
        <thead>
            <tr>
                <th width="100" align="right">名称</th>
                <th width="130">值</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td align="right">元件类型:</td>
                <td>
                    <input type="text" class="easyui-textbox" value="超链接" disabled="disabled">
                </td>
            </tr>
            <tr>
                <td align="right">显示方式:</td>
                <td>
                    <span>图片</span><input type="radio" name="ele.showType" id="showImage" value="img">
                    <span>文本</span><input type="radio" name="ele.showType" id="showText" value="text">
                </td>
            </tr>
            <tr>
                <td align="right">打开方式:</td>
                <td>
                    <select id="eleFalseAlter" class="defult-input">
                        <option value="_self">当前窗口</option>
                        <option value="_blank">新窗口</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td align="right">链接地址:</td>
                <td>
                    <div class="link-text-group">
                        <textarea cols="19" rows="3" id="eleTrueAlter" class="defult-input" placeholder="http://www.xxx.com"></textarea>
                    </div>
                </td>
            </tr>
            <tr class="property-type">
                <td>
                    <span class="datagrid-row-collapse">&nbsp;</span>
                    <span>位置</span>
                </td>
                <td></td>
            </tr>
            <tr>
                <td align="right">X轴坐标:</td>
                <td><input id="eleX" type="text" class="easyui-numberspinner" data-options="min:0" required="required"/></td>
            </tr>
            <tr>
                <td align="right">Y轴坐标:</td>
                <td><input id="eleY" type="text" class="easyui-numberspinner" data-options="min:0" required="required"/></td>
            </tr>
            <tr>
                <td align="right">宽:</td>
                <td><input id="eleWidth" type="text" class="easyui-numberspinner" data-options="min:0" required="required"/></td>
            </tr>
            <tr>
                <td align="right">高:</td>
                <td><input id="eleHeight" type="text" class="easyui-numberspinner" data-options="min:0" required="required"/></td>
            </tr>
            <tr>
                <td align="right">位置锁定:</td>
                <td><input id="elePosLock" style="height: 22px; width: 104px;"/></td>
            </tr>
            <tr class="property-type">
                <td>
                    <span class="datagrid-row-collapse">&nbsp;</span>
                    <span>文本</span>
                </td>
                <td></td>
            </tr>
            <tr class="linkText">
                <td align="right">内容:</td>
                <td>
                    <div class="link-text-group">
                        <textarea cols="19" rows="3" id="eleContent" class="defult-input"></textarea>
                    </div>
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">字体:</td>
                <td>
                    <select id="eleFontFamily" class="defult-input">
                        <option value="宋体">宋体</option>
                        <option value="黑体">黑体</option>
                        <option value="微软雅黑">微软雅黑</option>
                        <option value="华文细黑">华文细黑</option>
                        
                        <option value="Helvetica, sans-serif">Helvetica</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Lucida Grande', sans-serif">Lucida Grande</option>
                        <option value="Verdana,sans-serif">Verdana</option>
                        <option value="Tahoma, sans-serif">Tahoma</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        
                        <option value="Georgia, serif">Georgia</option>
                        <option value="Times, serif">Times</option>
                    </select>
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">字体大小:</td>
                <td>
                    <select id="eleFontSize" class="defult-input">
                        <option value="9px">9</option>
                        <option value="10px">10</option>
                        <option value="12px">12</option>
                        <option value="14px">14</option>
                        <option value="16px">16</option>
                        <option value="18px">18</option>
                        <option value="22px">22</option>
                        <option value="26px">26</option>
                        <option value="32px">32</option>
                        <option value="48px">48</option>
                        <option value="64px">64</option>
                        <option value="80px">80</option>
                    </select>
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">字体粗细:</td>
                <td>
                    <select id="eleFontWeight" class="defult-input">
                        <option value="normal">正常</option>
                        <option value="bolder">加粗</option>
                    </select>
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">字体颜色:</td>
                <td><input type="text" id="eleColor" class="input_cxcolor" readonly/></td>
            </tr>
            <tr class="property-type linkText">
                <td nowrap="nowrap">
                    <span class="datagrid-row-collapse">&nbsp;</span>
                    <span>背景/边框</span>
                </td>
                <td></td>
            </tr>
            <tr class="linkText">
                <td align="right">显隐:</td>
                <td>
                     <span>显示</span><input type="radio" name="ele.showBg" id="showBg1" value="1">
                     <span>隐藏</span><input type="radio" name="ele.showBg" id="showBg0" value="0">
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">圆角:</td>
                <td><input id="eleRadius" type="text" class="easyui-numberspinner"/></td>
            </tr>
            <tr class="linkText">
                <td align="right">填充颜色:</td>
                <td><input type="text" id="eleFill" class="input_cxcolor" readonly/></td>
            </tr>
            <tr class="linkText">
                <td align="right">边线颜色:</td>
                <td><input type="text" id="eleStroke" class="input_cxcolor" readonly/></td>
            </tr>
            <tr class="linkText">
                <td align="right">线型:</td>
                <td>
                    <input type="text" id="eleStrokeDasharray"/>
                    <ul id="dasharrayOption" class="line-group">
                        <li value="0"><div class="line line-option-1">&nbsp;</div></li>
                        <li value="3,3"><div class="line line-option-7">&nbsp;</div></li>
                        <li value="8,8"><div class="line line-option-8">&nbsp;</div></li>
                        <li value="16,8,3,3,3,8"><div class="line line-option-9">&nbsp;</div></li>
                    </ul>
                </td>
            </tr>
            <tr class="linkText">
                <td align="right">粗细:</td>
                <td>
                    <input id="eleStrokeWidth" type="text" />
                    <ul id="widthOption" class="line-group">
                        <li value="0"><div class="line-option-0">隐藏边线</div></li>
                        <li value="1"><div class="line line-option-1">&nbsp;</div></li>
                        <li value="2"><div class="line line-option-2">&nbsp;</div></li>
                        <li value="3"><div class="line line-option-3">&nbsp;</div></li>
                        <li value="4"><div class="line line-option-4">&nbsp;</div></li>
                        <li value="6"><div class="line line-option-5">&nbsp;</div></li>
                        <li value="8"><div class="line line-option-6">&nbsp;</div></li>
                    </ul>
                </td>
            </tr>
            <tr class="property-type linkImage">
                <td>
                    <span class="datagrid-row-collapse">&nbsp;</span>
                    <span>图片</span>
                </td>
                <td></td>
            </tr>
            <tr class="linkImage">
                <td align="right" class="td-img">
                    <div class="input-img-wapper">
                        <span></span><img id="eleLinkHref" alt="请选择" src="">
                    </div>
                </td>
                <td>
                    <a href="javascript:void(0);" id="btnImageDB" class="btn-lg">
                           <span class="icon icon-db">&nbsp;</span>图库
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
    </form>
    <script type="text/javascript">
    $(function(){
        $.parser.parse('#LinkForm');
    
        //初始化线型、线宽下拉列表。
        var setdasharray = function(value){
            d3.select("svg > g.active > rect.link-text")
            .style("stroke-dasharray",function(d){
                if(d.strokeDasharray!=value){
                    savePropertyUndo();
                }
                d.strokeDasharray=value;
                return d.strokeDasharray;
            });
        }
        var setwidth = function(value){
            d3.select("svg > g.active > rect.link-text")
            .style("stroke-width",function(d){
                if(d.strokeWidth!=value){
                    savePropertyUndo();
                }
                d.strokeWidth=value;
                return d.strokeWidth;
            });
        }
        initStrokeSelect(setdasharray,setwidth);
    
        //链接显示类型
        $("#LinkForm input[name='ele.showType']").click(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(!d)return false;
            var showtype = $("#LinkForm input[name='ele.showType']:checked").val();
            if(d.type!=showtype){
                savePropertyUndo();
            }
            if(showtype=='text'){
                d.type = 'linkText';
                resetLinkText(d3.select("svg > g.active"));
            }else{
                d.type = 'linkImage';
                resetLinkImage(d3.select("svg > g.active"));
            }
        });
        //页面打开方式
        $("#eleFalseAlter").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.falseAlter!=$("#eleFalseAlter").val()){
                savePropertyUndo();
            }
            d.falseAlter=$("#eleFalseAlter").val();
        });
        
        //点击元件库
        $("#btnImageDB").click(function(){
            $("#propertyPanel img.active").removeClass("active");
            $("#eleLinkHref").addClass("active");
            $("#dlgToolbar").show();
            $("#dlgButtons").show();
            var node = $('#dbMenu').tree('find', 9);
            $('#dbMenu').tree('select', node.target);
            loadImages(node.type);
            $('#databaseDialog').dialog("open");
        });
    
        //链接地址
        $("#eleTrueAlter").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                if(d.trueAlter!=$("#eleTrueAlter").val()){
                    savePropertyUndo();
                }
                d.trueAlter=$("#eleTrueAlter").val();
            }
        });
        
        //位置
        $("#eleX").parent().find("input.textbox-text").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                //设置值
                var value = $(this).val();
                if(value=='' || value<0){
                    value = 0;
                }
                //保存撤销信息
                if(d.x!=parseInt(value)){
                    saveMoveUndo();
                }
                d.x=parseInt(value);
                //修改元件位置
                d3.select("svg > g.active > rect.link-text").attr("x",d.x);
                d3.select("svg > g.active > text.link-text").attr("x",Math.round(d.x+d.width/2));
                d3.select("svg > g.active > image.link-image").attr("x",d.x);
                moveRectPoint(d3.select("svg > g.active"));
            }
        });
        $("#eleY").parent().find("input.textbox-text").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                //设置值
                var value = $(this).val();
                if(value=='' || value<0){
                    value = 0;
                }
                //保存撤销信息
                if(d.y!=parseInt(value)){
                    saveMoveUndo();
                }
                d.y=parseInt(value);
                //修改元件位置
                d3.select("svg > g.active > rect.link-text").attr("y",d.y);
                d3.select("svg > g.active > text.link-text").attr("y",Math.round(d.y+d.height/2));
                d3.select("svg > g.active > image.link-image").attr("y",d.y);
                moveRectPoint(d3.select("svg > g.active"));
            }
        });
        $("#eleWidth").parent().find("input.textbox-text").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                //设置值
                var value = $(this).val();
                if(value=='' || value<0){
                    value = 0;
                }
                //保存撤销信息
                if(d.width!=parseInt(value)){
                    saveMoveUndo();
                }
                d.width=parseInt(value);
                //修改元件位置
                d3.select("svg > g.active > rect.link-text").attr("width",d.width);
                d3.select("svg > g.active > text.link-text").attr("x",Math.round(d.x+d.width/2));
                d3.select("svg > g.active > image.link-image").attr("width",d.width);
                moveRectPoint(d3.select("svg > g.active"));
            }
        });
        $("#eleHeight").parent().find("input.textbox-text").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                //设置值
                var value = $(this).val();
                if(value=='' || value<0){
                    value = 0;
                }
                //保存撤销信息
                if(d.height!=parseInt(value)){
                    saveMoveUndo();
                }
                d.height=parseInt(value);
                //修改元件位置
                d3.select("svg > g.active > rect.link-text").attr("height",d.height);
                d3.select("svg > g.active > text.link-text").attr("y",Math.round(d.y+d.height/2));
                d3.select("svg > g.active > image.link-image").attr("height",d.height);
                moveRectPoint(d3.select("svg > g.active"));
            }
        });
        $("#elePosLock").switchbutton({
            checked: false,
            onText:"开启",
            offText:"关闭",
            onChange: function(checked){
                var d = d3.select("svg > g.active").data()[0];
                d.posLock = checked;
                if(checked){
                    numberDisable();
                    d3.select("svg > g.active").classed("lock",true);
                }else{
                    numberEnable();
                    d3.select("svg > g.active").classed("lock",false);
                }
            }
        });
    
        //文本
        $("#eleContent").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                if(d.content!=$("#eleContent").val()){
                    savePropertyUndo();
                }
                d.content=$("#eleContent").val();
                d3.select("svg > g.active > text.link-text").text(d.content);
            }
        });
        $("#eleFontFamily").change(function(){
            d3.select("svg > g.active >text.link-text")
            .style("font-family",function(d){
                if(d.fontFamily!=$("#eleFontFamily").val()){
                    savePropertyUndo();
                }
                d.fontFamily=$("#eleFontFamily").val();
                return d.fontFamily;
            });
        });
        $("#eleFontSize").change(function(){
            d3.select("svg > g.active >text.link-text")
            .style("font-size",function(d){
                if(d.fontSize!=$("#eleFontSize").val()){
                    savePropertyUndo();
                }
                d.fontSize=$("#eleFontSize").val();
                return d.fontSize;
            });
        });
        $("#eleFontWeight").change(function(){
            d3.select("svg > g.active >text.link-text")
            .style("font-weight",function(d){
                if(d.fontWeight!=$("#eleFontWeight").val()){
                    savePropertyUndo();
                }
                d.fontWeight=$("#eleFontWeight").val();
                return d.fontWeight;
            });
        });
        $("#eleColor").change(function(){
            d3.select("svg > g.active >text.link-text")
            .style("fill",function(d){
                if(d.color!=$("#eleColor").val()){
                    savePropertyUndo();
                }
                d.color=$("#eleColor").val();
                return d.color;
            });
        });
        
        //背景/边框
        $("#LinkForm input[name='ele.showBg']").click(function(){
             var showBg = $(this).val();
            d3.select("svg > g.active >rect.link-text")
            .style("opacity",function(d){
                if(d.showBg!=showBg){
                    savePropertyUndo();
                }
                d.showBg=showBg;
                return d.showBg;
            });
        });
        $("#eleRadius").parent().find("input.textbox-text").change(function(){
            var d = d3.select("svg > g.active").data()[0];
            if(d.id== $("#LinkForm input[name='ele.id']").val()){
                //设置值
                var value = $(this).val();
                if(value=='' || value<0){
                    value = 0;
                }
                if(d.radius!=parseInt(value)){
                    savePropertyUndo();
                }
                d.radius=parseInt(value);
                //修改圆角大小
                d3.select("svg > g.active > rect.link-text").attr("rx",d.radius);
                d3.select("svg > g.active > rect.link-text").attr("ry",d.radius);
            }
        });
        $("#eleFill").change(function(){
            d3.select("svg > g.active > rect.link-text")
            .style("fill",function(d){
                if(d.fill!=$("#eleFill").val()){
                    savePropertyUndo();
                }
                d.fill=$("#eleFill").val();
                return d.fill;
            });
        });
        $("#eleStroke").change(function(){
            d3.select("svg > g.active >rect.link-text")
            .style("stroke",function(d){
                if(d.stroke!=$("#eleStroke").val()){
                    savePropertyUndo();
                }
                d.stroke=$("#eleStroke").val();
                return d.stroke;
            });
        });
        
        //数值输入框右侧加1、减1功能触发对应的修改事件。
        $("#eleX,#eleY,#eleWidth,#eleHeight,#eleRadius").parent().find("span.textbox-addon").click(function(){
            $(this).parent().find("input.textbox-text").change();
        });
        //触发修改以后关闭页面提示“未保存”
        $("#LinkForm input,#LinkForm select,#LinkForm textarea").change(bindBeforeunload);
    });
    </script>